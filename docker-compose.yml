services:
  ml_api:
    build: .
    container_name: measurement-api
    restart: always
    ports:
      - "8512:8512"  # Expose on port 8000 of your host machine
    networks:
      - lavie_database
    env_file:
      - .envs/ml.env
      - .envs/db.env
    environment:
      DB_HOST: lavie_postgres
      DB_USER: postgres
      DB_PASSWORD: postgres
      DB_NAME: lavie
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8512/" ]
      interval: 30s      # Check every 30 seconds
      timeout: 5s       # Fail if it takes longer than 5s
      retries: 3         # Mark unhealthy after 3 failures
      start_period: 15s  # Give the app 10s to start up before checking

networks:
  lavie_database:
    external: true
